"""
경희대 환산 점수 간단 테스트
네트워크 없이 로컬에서만 테스트
"""

import sys
import os

sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from services.khu_score_calculator import calculate_khu_score

# 테스트 데이터 1: 상위권 학생 (11211)
print("="*80)
print("테스트 1: 상위권 학생 (국어 1등급, 수학 1등급, 영어 2등급, 탐구 1/1등급)")
print("="*80)

test1 = {
    "과목별_성적": {
        "국어": {"등급": 1, "표준점수": 138, "백분위": 98},
        "수학": {"등급": 1, "표준점수": 135, "백분위": 99},
        "영어": {"등급": 2, "백분위": 82.5},
        "탐구1": {"등급": 1, "표준점수": 60, "백분위": 98},
        "탐구2": {"등급": 1, "표준점수": 60, "백분위": 98}
    },
    "선택과목": {
        "국어": "화법과작문",
        "수학": "확률과통계",
        "탐구_추론": "인문계 (사회문화/생활과윤리)"
    }
}

khu1 = calculate_khu_score(test1)
for track, data in khu1.items():
    if data["계산_가능"]:
        print(f"{track:8s}: {data['최종점수']:6.1f}점 / 600점", end="")
        if data['과탐_가산점'] > 0:
            print(f" (과탐가산 +{data['과탐_가산점']}점)", end="")
        print()

# 테스트 데이터 2: 자연계 최상위 (미적분 + 과탐)
print("\n" + "="*80)
print("테스트 2: 자연계 최상위 (미적분 + 과탐, 과학탐구 가산점 적용)")
print("="*80)

test2 = {
    "과목별_성적": {
        "국어": {"등급": 1, "표준점수": 140, "백분위": 99},
        "수학": {"등급": 1, "표준점수": 135, "백분위": 99},
        "영어": {"등급": 1, "백분위": 97},
        "한국사": {"등급": 1},
        "탐구1": {"등급": 1, "표준점수": 70, "백분위": 99},
        "탐구2": {"등급": 1, "표준점수": 66, "백분위": 95}
    },
    "선택과목": {
        "국어": "언어와매체",
        "수학": "미적분",
        "탐구_추론": "자연계 (지구과학1/생명과학1)"  # 과탐 가산점 트리거
    }
}

khu2 = calculate_khu_score(test2)
for track, data in khu2.items():
    if data["계산_가능"]:
        print(f"{track:8s}: {data['최종점수']:6.1f}점 / 600점", end="")
        if data['과탐_가산점'] > 0:
            print(f" (과탐가산 +{data['과탐_가산점']}점) ← 자연계 과탐 보너스!", end="")
        print()

# 테스트 데이터 3: 영어/한국사 감점 케이스
print("\n" + "="*80)
print("테스트 3: 영어 4등급, 한국사 5등급 (감점 적용)")
print("="*80)

test3 = {
    "과목별_성적": {
        "국어": {"등급": 2, "표준점수": 130, "백분위": 93},
        "수학": {"등급": 2, "표준점수": 128, "백분위": 91},
        "영어": {"등급": 4, "백분위": 32},  # 4등급: -3점 (600점 기준)
        "한국사": {"등급": 5},  # 5등급: -1.5점 (600점 기준)
        "탐구1": {"등급": 2, "표준점수": 58, "백분위": 92},
        "탐구2": {"등급": 2, "표준점수": 58, "백분위": 92}
    },
    "선택과목": {
        "국어": "화법과작문",
        "수학": "확률과통계",
        "탐구_추론": "인문계"
    }
}

khu3 = calculate_khu_score(test3)
for track, data in khu3.items():
    if data["계산_가능"]:
        eng_ded = data['영어_감점']
        hist_ded = data['한국사_감점']
        print(f"{track:8s}: {data['최종점수']:6.1f}점 / 600점", end="")
        if eng_ded != 0 or hist_ded != 0:
            print(f" (영어 {eng_ded:+.1f}점, 한국사 {hist_ded:+.1f}점)", end="")
        print()

print("\n" + "="*80)
print("✅ 경희대 환산 점수 계산 완료!")
print("="*80)
print("\n주요 특징:")
print("- 4개 계열(인문/사회/자연/예술체육) 동시 계산")
print("- 자연계 과학탐구 가산점 자동 적용 (과목당 +4점)")
print("- 영어/한국사 감점제 적용 (600점 만점 기준)")
print("- API 호출 없는 순수 로컬 연산 (< 1ms)")
